



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="介绍物联网基础概念">
      
      
      
        <meta name="author" content="WiSys Lob">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="zh">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-ponylang-0.2.5">
    
    
      
        <title>9.1 定位感知 - IoT Book</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.dfc6cb0c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../../../assets/javascripts/modernizr.6586f7cd.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../../#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
          <a href="../../.." title="IoT Book" class="md-header-nav__button md-logo">
          
            <img src="../../../images/nicon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                IoT Book
              </span>
              <span class="md-header-nav__topic">
                9.1 定位感知
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../../images/nicon.png" width="48" height="48">
      
    </span>
    IoT Book
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../1. 前言/物联网导论/" title="一. 前言" class="md-nav__link">
      一. 前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../2. 物联网简介/物联网简介/" title="二. 物联网简介" class="md-nav__link">
      二. 物联网简介
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      三. 开发环境
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        三. 开发环境
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../平台搭建/android开发基础/" title="3.1 Android 环境" class="md-nav__link">
      3.1 Android 环境
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../平台搭建/matlab基础/" title="3.2 MATLAB 环境" class="md-nav__link">
      3.2 MATLAB 环境
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      四. 物联网网络协议
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        四. 物联网网络协议
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/物联网连接技术/" title="4.1 物联网连接技术" class="md-nav__link">
      4.1 物联网连接技术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/4.2 Wi-Fi无线局域网/" title="4.2 Wi-Fi无线局域网" class="md-nav__link">
      4.2 Wi-Fi无线局域网
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/4.3 蓝牙/" title="4.3 蓝牙" class="md-nav__link">
      4.3 蓝牙
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/4.4 ZigBee/" title="4.4 ZigBee" class="md-nav__link">
      4.4 ZigBee
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/4.5 毫米波通信/" title="4.5 毫米波通信" class="md-nav__link">
      4.5 毫米波通信
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/4.6 可见光通信/" title="4.6 可见光通信" class="md-nav__link">
      4.6 可见光通信
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/4.7 低功耗广域网/" title="4.7 低功耗广域网" class="md-nav__link">
      4.7 低功耗广域网
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/蓝牙实验/" title="4.8 蓝牙连接实验" class="md-nav__link">
      4.8 蓝牙连接实验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3. 物联网通信协议/LoRa编码和通信实验/" title="4.9 LoRa编码和通信实验" class="md-nav__link">
      4.9 LoRa编码和通信实验
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      五. 物联网通信基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        五. 物联网通信基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../4. 物联网通信基础/5.1 采样和量化/" title="5.1 采样和量化" class="md-nav__link">
      5.1 采样和量化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4. 物联网通信基础/5.2 傅立叶分析/" title="5.2 傅立叶分析" class="md-nav__link">
      5.2 傅立叶分析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4. 物联网通信基础/5.3 无线信道/" title="5.3 无线信道" class="md-nav__link">
      5.3 无线信道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4. 物联网通信基础/5.4 滤波/" title="5.4 信号滤波" class="md-nav__link">
      5.4 信号滤波
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4. 物联网通信基础/4.2 调制解调方法及其声音实现/" title="5.5 调制解调方法" class="md-nav__link">
      5.5 调制解调方法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      六. 物联网网络构建技术
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        六. 物联网网络构建技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="6.1 低功耗物联网" class="md-nav__link">
      6.1 低功耗物联网
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="6.2 多跳自组织网" class="md-nav__link">
      6.2 多跳自组织网
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="6.3 网络冲突处理" class="md-nav__link">
      6.3 网络冲突处理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="6.4 跨协议识别与通信" class="md-nav__link">
      6.4 跨协议识别与通信
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      七. 物联网定位与追踪
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        七. 物联网定位与追踪
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="7.1 无线测距" class="md-nav__link">
      7.1 无线测距
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="7.2 定位技术" class="md-nav__link">
      7.2 定位技术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="7.3 追踪技术" class="md-nav__link">
      7.3 追踪技术
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      八. 物联网感知技术
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        八. 物联网感知技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="8.1 传感器感知" class="md-nav__link">
      8.1 传感器感知
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="8.2 行为识别" class="md-nav__link">
      8.2 行为识别
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="8.3 身份认证" class="md-nav__link">
      8.3 身份认证
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      九. 物联网综合应用平台
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        九. 物联网综合应用平台
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        9.1 定位感知
      </label>
    
    <a href="./" title="9.1 定位感知" class="md-nav__link md-nav__link--active">
      9.1 定位感知
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        
          <li class="md-nav__item">
    <a href="#1-android-gps" title="1. Android GPS定位" class="md-nav__link">
    1. Android GPS定位
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          
            <li class="md-nav__item">
    <a href="#11" title="1.1. 获取系统定位服务" class="md-nav__link">
    1.1. 获取系统定位服务
  </a>
  
</li>
          
        
          
            <li class="md-nav__item">
    <a href="#12" title="1.2. 监听位置更新" class="md-nav__link">
    1.2. 监听位置更新
  </a>
  
</li>
          
        
      </ul>
    </nav>
  
</li>
        
      
        
          <li class="md-nav__item">
    <a href="#2-android" title="2. Android 地图展示" class="md-nav__link">
    2. Android 地图展示
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          
            <li class="md-nav__item">
    <a href="#21-api" title="2.1. 百度地图API" class="md-nav__link">
    2.1. 百度地图API
  </a>
  
</li>
          
        
          
            <li class="md-nav__item">
    <a href="#22" title="2.2. 显示地图" class="md-nav__link">
    2.2. 显示地图
  </a>
  
</li>
          
        
          
            <li class="md-nav__item">
    <a href="#23" title="2.3. 在地图上显示实时位置" class="md-nav__link">
    2.3. 在地图上显示实时位置
  </a>
  
</li>
          
        
      </ul>
    </nav>
  
</li>
        
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="9.2 阿里云平台" class="md-nav__link">
      9.2 阿里云平台
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="9.3 LoRa测试床" class="md-nav__link">
      9.3 LoRa测试床
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../404/" title="9.4 物联网开发" class="md-nav__link">
      9.4 物联网开发
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        
          <li class="md-nav__item">
    <a href="#1-android-gps" title="1. Android GPS定位" class="md-nav__link">
    1. Android GPS定位
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          
            <li class="md-nav__item">
    <a href="#11" title="1.1. 获取系统定位服务" class="md-nav__link">
    1.1. 获取系统定位服务
  </a>
  
</li>
          
        
          
            <li class="md-nav__item">
    <a href="#12" title="1.2. 监听位置更新" class="md-nav__link">
    1.2. 监听位置更新
  </a>
  
</li>
          
        
      </ul>
    </nav>
  
</li>
        
      
        
          <li class="md-nav__item">
    <a href="#2-android" title="2. Android 地图展示" class="md-nav__link">
    2. Android 地图展示
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          
            <li class="md-nav__item">
    <a href="#21-api" title="2.1. 百度地图API" class="md-nav__link">
    2.1. 百度地图API
  </a>
  
</li>
          
        
          
            <li class="md-nav__item">
    <a href="#22" title="2.2. 显示地图" class="md-nav__link">
    2.2. 显示地图
  </a>
  
</li>
          
        
          
            <li class="md-nav__item">
    <a href="#23" title="2.3. 在地图上显示实时位置" class="md-nav__link">
    2.3. 在地图上显示实时位置
  </a>
  
</li>
          
        
      </ul>
    </nav>
  
</li>
        
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">定位感知实验<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="1-android-gps">1. Android GPS定位<a class="headerlink" href="#1-android-gps" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1. 获取系统定位服务<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<p>Android在操作系统底层实现了GPS硬件驱动，并封装了服务管理类<code>LocationManager</code>供应用开发者获取设备当前的位置信息。<code>LocationManager</code>是获取位置信息的入口级类，开发者要获取位置信息前，需要首先通过调用系统服务，初始化一个<code>LocationManger</code>对象：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">LocationManager</span>  <span class="n">locationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">LocationManager</span><span class="o">)</span> <span class="n">Context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">LOCATION_SERVICE</span><span class="o">);</span>
</pre></div>
</td></tr></table>

<p><code>LocationManager</code>对象以<code>Location</code>对象的形式提供设备当前的位置信息，<code>Location</code>是一个描述地理位置信息的类，记录了经纬度、海拔高度、获取坐标时间、速度、方位等数据。从<code>LocationManager</code>获得<code>Location</code>对象的方法是<code>getLastKnowLocation()</code>。这里要注意的是，除了GPS，安卓还支持Wi-Fi、蜂窝基站和AGPS等另外三种定位方式，因此通过<code>LocationManager.getLastKnowLocation()</code>获取GPS地理位置信息时，需要指明位置信息的提供者是<code>LocationManager.GPS_PROVIDER</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">Location</span> <span class="n">location</span> <span class="o">=</span> <span class="n">locationManager</span><span class="o">.</span><span class="na">getLastKnownLocation</span><span class="o">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="na">GPS_PROVIDER</span><span class="o">);</span> <span class="c1">// 通过GPS获取位置</span>
</pre></div>
</td></tr></table>

<p>通过系统提供的定位服务，我们就可以从GPS传感器中读取到设备当前的位置信息，当然前提是开发者已经为应用赋予了运行时权限管理。静态权限在<code>AndroidManifest.xml</code>文件的<code>&lt;application/&gt;</code>标签外部添加</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c">&lt;!-- 这个权限用于进行网络定位 --&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- 这个权限用于访问GPS定位 --&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table>

<p>动态权限在<code>getLastKnowLocation()</code>方法调用前添加</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> <span class="c1">// 运行时权限管理</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_FINE_LOCATION</span><span class="o">)</span>
        <span class="o">!=</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span>
        <span class="o">&amp;&amp;</span> <span class="n">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">)</span>
        <span class="o">!=</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span>
<span class="o">{</span>
    <span class="n">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span>
                    <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">,</span>
                    <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_FINE_LOCATION</span><span class="o">},</span><span class="mi">100</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>最后在安卓布局文件中添加一个按钮和一个文本框。每次点击按钮时，调用<code>getLastKnowLocation()</code>方法，并将返回的设备当前位置信息显示到文本框内：</p>
<p><img alt="" src="../res/app2.png" />
<center>
<div style="color:orange; border-bottom: 1px solid #d9d9d9;
display: inline-block;
color: #999;
padding: 2px;">图. 安卓模拟器设置虚拟GPS数据，APP读数并显示</div>
</center></p>
<p><strong><mark>可能出现的问题</mark></strong></p>
<ol>
<li>如果你是在真实安卓手机上实现上述程序，则调用<code>getLastKnowLocation()</code>后可能返回的是一个空对象<code>null</code>。造成这一问题的原因通常是因为手机在室内环境下无法连接到GSP卫星，从而无法获取到GPS位置信息。只要步行至室外开阔环境下， 上述程序即可正常工作。</li>
<li>如果你不是使用<code>getLastKnowLocation()</code>获取GPS数据，而是使用百度地图、高德地图等SDK中的获取位置函数，则可能在基于Intel x86架构的安卓模拟器上无法正常获取定位，需要安卓真机上调试。</li>
</ol>
<p><strong>获取GPS信息完整代码</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">androidx.core.app.ActivityCompat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.Manifest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.pm.PackageManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.location.Location</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.location.LocationManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.baidu.mapapi.map.BaiduMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.baidu.mapapi.map.MapView</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">LocationManager</span> <span class="n">locationManager</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">textLocationShow</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Button</span> <span class="n">btnLocation</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">MapView</span> <span class="n">mMapView</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">BaiduMap</span> <span class="n">mBaiduMap</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="c1">// 获取定位服务</span>
        <span class="n">locationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">LocationManager</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">LOCATION_SERVICE</span><span class="o">);</span>
        <span class="c1">// 初始化View组件信息及相关点击事件</span>
        <span class="n">initViews</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="cm">/**</span>
<span class="cm">     * 方法描述：初始化View组件信息及相关点击事件</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initViews</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">textLocationShow</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">text_location_show</span><span class="o">);</span>
        <span class="n">btnLocation</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn_location</span><span class="o">);</span>
        <span class="c1">//获取地图控件引用</span>
        <span class="n">mMapView</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bmapView</span><span class="o">);</span>
        <span class="c1">// 点击按钮显示坐标</span>
        <span class="n">btnLocation</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">getLocation</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">getLocation</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 运行时权限管理</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_FINE_LOCATION</span><span class="o">)</span>
                <span class="o">!=</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span>
                <span class="o">&amp;&amp;</span> <span class="n">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">)</span>
                <span class="o">!=</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span>
                    <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">,</span>
                    <span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_FINE_LOCATION</span><span class="o">},</span><span class="mi">100</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// 通过GPS服务获取位置信息</span>
        <span class="n">Location</span> <span class="n">location</span> <span class="o">=</span> <span class="n">locationManager</span><span class="o">.</span><span class="na">getLastKnownLocation</span><span class="o">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="na">GPS_PROVIDER</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">location</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">updateUI</span><span class="o">(</span><span class="n">location</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 方法描述：在View上更新位置信息的显示</span>
<span class="cm">     * @param location</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">updateUI</span><span class="o">(</span><span class="n">Location</span> <span class="n">location</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">double</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">();</span>
        <span class="kt">double</span> <span class="n">latitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">();</span>
        <span class="n">textLocationShow</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;当前经度：&quot;</span> <span class="o">+</span> <span class="n">longitude</span> <span class="o">+</span> <span class="s">&quot;\n当前纬度：&quot;</span> <span class="o">+</span> <span class="n">latitude</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="c1">//在activity执行onResume时执行mMapView. onResume ()，实现地图生命周期管理</span>
        <span class="n">mMapView</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
        <span class="c1">//在activity执行onPause时执行mMapView. onPause ()，实现地图生命周期管理</span>
        <span class="n">mMapView</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
        <span class="c1">//在activity执行onDestroy时执行mMapView.onDestroy()，实现地图生命周期管理</span>
        <span class="n">mMapView</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h3 id="12">1.2. 监听位置更新<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<p>在上面的实现方式中，只有在用户主动调用<code>getLastKnowLocation()</code>时位置信息才会更新，是否可以让位置信息在设备位置变化时自动更新呢？</p>
<p>为了实现这一功能，我们需要借助于位置监听接口：<code>LocationListener</code>。<code>LocationListener</code>是Android默认提供的一个监听接口，用于监听位置（包括GPS、网络、基站等所有提供位置的）变化、设备开关与状态，通过该接口可以实时动态地获取设备位置信息。我们首先使用内部类或者匿名实现该接口，然后在相关方法中添加实现功能的代码，最后注册监听：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm">* 实现位置监听接口</span>
<span class="cm">*/</span>
<span class="kd">private</span> <span class="n">LocationListener</span> <span class="n">locationListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocationListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="cm">/**</span>
<span class="cm">    * 位置信息变化时触发:当坐标改变时触发此函数，如果Provider传进相同的坐标，它就不会被触发</span>
<span class="cm">    * @param location</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLocationChanged</span><span class="o">(</span><span class="n">Location</span> <span class="n">location</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;时间：&quot;</span> <span class="o">+</span> <span class="n">location</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;经度：&quot;</span> <span class="o">+</span> <span class="n">location</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">());</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;纬度：&quot;</span> <span class="o">+</span> <span class="n">location</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">());</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;海拔：&quot;</span> <span class="o">+</span> <span class="n">location</span><span class="o">.</span><span class="na">getAltitude</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">    * GPS状态变化时触发:Provider被disable时触发此函数，比如GPS被关闭</span>
<span class="cm">    * @param provider</span>
<span class="cm">    * @param status</span>
<span class="cm">    * @param extras</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStatusChanged</span><span class="o">(</span><span class="n">String</span> <span class="n">provider</span><span class="o">,</span> <span class="kt">int</span> <span class="n">status</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">status</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//GPS状态为可见时</span>
            <span class="k">case</span> <span class="n">LocationProvider</span><span class="o">.</span><span class="na">AVAILABLE</span><span class="o">:</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;onStatusChanged：当前GPS状态为可见状态&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="c1">//GPS状态为服务区外时</span>
            <span class="k">case</span> <span class="n">LocationProvider</span><span class="o">.</span><span class="na">OUT_OF_SERVICE</span><span class="o">:</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;onStatusChanged:当前GPS状态为服务区外状态&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="c1">//GPS状态为暂停服务时</span>
            <span class="k">case</span> <span class="n">LocationProvider</span><span class="o">.</span><span class="na">TEMPORARILY_UNAVAILABLE</span><span class="o">:</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;onStatusChanged:当前GPS状态为暂停服务状态&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">    * 方法描述：GPS开启时触发</span>
<span class="cm">    * @param provider</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProviderEnabled</span><span class="o">(</span><span class="n">String</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;onProviderEnabled:方法被触发&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="n">getLocation</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">    * 方法描述： GPS禁用时触发</span>
<span class="cm">    * @param provider</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProviderDisabled</span><span class="o">(</span><span class="n">String</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">};</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// 注册监听，当时间为间隔100毫秒或位移变化超过0米时更新</span>
<span class="n">locationManager</span><span class="o">.</span><span class="na">requestLocationUpdates</span><span class="o">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="na">GPS_PROVIDER</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">locationListener</span><span class="o">);</span>
</pre></div>
</td></tr></table>

<h2 id="2-android">2. Android 地图展示<a class="headerlink" href="#2-android" title="Permanent link">&para;</a></h2>
<h3 id="21-api">2.1. 百度地图API<a class="headerlink" href="#21-api" title="Permanent link">&para;</a></h3>
<p>百度地图提供了一套基于Android 4.0及以上版本设备的应用程序接口，开发者可以使用该套SDK开发适用于Android系统移动设备的地图应用。开发者通过调用百度地图SDK接口，可以访问百度地图服务和数据，实现地图展示、定位、导航功能。</p>
<p>开发者在使用SDK之前需要获取<a href="http://lbsyun.baidu.com/apiconsole/key">百度地图移动版开发密钥（AK）</a>，该密钥与个人的百度账户相关联。请妥善保存AK，之后程序开发过程中需要使用该AK。</p>
<h3 id="22">2.2. 显示地图<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<p><a href="http://lbsyun.baidu.com/index.php?title=sdk/download&amp;action#selected=mapsdk_basicmap,mapsdk_searchfunction,mapsdk_lbscloudsearch,mapsdk_calculationtool,mapsdk_radar">点击下载百度地图开发包</a>，解压后将文件夹<code>libs</code>下的所有文件拷贝至工程的<code>app/libs</code>目录下，<code>libs</code>目录下包括一个jar包和若干适配不同系统的so文件。</p>
<p>接下来将jar文件集成到我们的工程中：菜单栏选择File -&gt; Project Structure，在弹出的Project Structure对话框中选中左侧的Modules列表下当前模块的名字，然后点击右侧页面中的Dependencies选项卡。</p>
<p><img alt="" src="../res/p1.png" />
<center>
<div style="color:orange; border-bottom: 1px solid #d9d9d9;
display: inline-block;
color: #999;
padding: 2px;">图. 集成jar文件</div>
</center></p>
<p>然后配置so文件路径，使得SDK代码可以找到<code>libs</code>文件夹下的so文件。在app目录下的build.gradle文件中android块中配置sourceSets标签，如果没有使用该标签则新增，配置代码如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sourceSets {
    main {
        jniLibs.srcDir &#39;libs&#39;
    }
}
</pre></div>
</td></tr></table>

<p>上述配置操作完成后，我们就可以调用SDK显示地图控件了：</p>
<p><strong>第一步 配置AndroidManifest.xml文件</strong></p>
<p>在<application>中加入如下代码配置开发密钥（AK）：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">&lt;application&gt;</span>
    <span class="nt">&lt;meta-data</span>
        <span class="na">android:name=</span><span class="s">&quot;com.baidu.lbsapi.API_KEY&quot;</span>
        <span class="na">android:value=</span><span class="s">&quot;开发者 key&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/application&gt;</span>
</pre></div>
</td></tr></table>

<p>对于Android6.0以前版本，在<code>&lt;application/&gt;</code>外部添加如下静态权限声明：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c">&lt;!-- 访问网络，进行地图相关业务数据请求，包括地图数据，路线规划，POI检索等 --&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- 获取网络状态，根据网络状态切换进行数据请求网络转换 --&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- 读取外置存储。如果开发者使用了so动态加载功能并且把so文件放在了外置存储区域，则需要申请该权限，否则不需要 --&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- 写外置存储。如果开发者使用了离线地图，并且数据写在外置存储区域，则需要申请该权限 --&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table>

<p>对于Android6.0及以后版本，部分权限的需要开发者在代码中动态申请。</p>
<p><strong>第二步 在布局文件中添加地图容器</strong></p>
<p>MapView是View的一个子类，用于在Android View中放置地图。MapView的使用方法与Android提供的其他View一样。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">&lt;com.baidu.mapapi.map.MapView</span>
    <span class="na">android:id=</span><span class="s">&quot;@+id/bmapView&quot;</span>
    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">android:clickable=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</td></tr></table>

<p><strong>第三步 地图初始化</strong></p>
<p>新建一个自定义的Application（即创建一个继承自Application的java类，并在在AndroidManifest.xml文件的Application闭包中声明该类），在其onCreate方法中完成SDK的初始化。示例代码如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoApplication</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="c1">//在使用SDK各组件之前初始化context信息，传入ApplicationContext</span>
        <span class="n">SDKInitializer</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="c1">//自4.3.0起，百度地图SDK所有接口均支持百度坐标和国测局坐标，用此方法设置您使用的坐标类型.</span>
        <span class="c1">//包括BD09LL和GCJ02两种坐标，默认是BD09LL坐标。</span>
        <span class="n">SDKInitializer</span><span class="o">.</span><span class="na">setCoordType</span><span class="o">(</span><span class="n">CoordType</span><span class="o">.</span><span class="na">BD09LL</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">&lt;application</span>
    <span class="na">android:name=</span><span class="s">&quot;.DemoApplication&quot;</span>
</pre></div>
</td></tr></table>

<p><strong>第四步 创建地图Activity，管理MapView生命周期</strong></p>
<p>最后只需要在<code>MainActivity</code>中实例化MapView对象，在activity执行onResume时执行<code>mMapView.onResume()</code>，即可在应用中展示地图数据。注意在项目中使用地图时，要注意合理地管理地图生命周期。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">MapView</span> <span class="n">mMapView</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="c1">//获取地图控件引用</span>
        <span class="n">mMapView</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bmapView</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
       <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
       <span class="c1">//在activity执行onResume时执行mMapView. onResume ()，实现地图生命周期管理</span>
       <span class="n">mMapView</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
      <span class="c1">//在activity执行onPause时执行mMapView. onPause ()，实现地图生命周期管理</span>
      <span class="n">mMapView</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
      <span class="c1">//在activity执行onDestroy时执行mMapView.onDestroy()，实现地图生命周期管理</span>
      <span class="n">mMapView</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>
</td></tr></table>

<p><img alt="" src="../res/app3.png" />
<center>
<div style="color:orange; border-bottom: 1px solid #d9d9d9;
display: inline-block;
color: #999;
padding: 2px;">图. 在应用中显示地图控件</div>
</center></p>
<h3 id="23">2.3. 在地图上显示实时位置<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<p>最后我们将第一节中获取到的GPS位置数据与地图信息结合，在地图控件上实时显示设备当前的位置。</p>
<p>为实现这一功能，我们需要借助百度地图APK提供的<code>BaiduMap</code>类对地图控件进行管理，在指定地图坐标处输出定位图标。具体代码实现如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// 地图控件管理对象</span>
<span class="n">BaiduMap</span> <span class="n">mBaiduMap</span> <span class="o">=</span> <span class="n">mMapView</span><span class="o">.</span><span class="na">getMap</span><span class="o">();</span>
<span class="c1">// 开启地图控件的定位功能</span>
<span class="n">mBaiduMap</span><span class="o">.</span><span class="na">setMyLocationEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="c1">// 获取经纬度及海拔高度信息，存入百度地图指定的坐标信息类MyLocationData</span>
<span class="n">MyLocationData</span> <span class="n">locData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyLocationData</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">accuracy</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">getAccuracy</span><span class="o">())</span>
        <span class="o">.</span><span class="na">latitude</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">())</span>
        <span class="o">.</span><span class="na">longitude</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>
<span class="c1">// 在地图上显示定位图标</span>
<span class="n">mBaiduMap</span><span class="o">.</span><span class="na">setMyLocationData</span><span class="o">(</span><span class="n">locData</span><span class="o">);</span>
</pre></div>
</td></tr></table>

<p>将上述代码添加到位置监听器的回调函数中，则每次设备位置更新时，地图上的定位图标也会相应地进行更新。</p>
<p><img alt="" src="../res/app4.png" />
<center>
<div style="color:orange; border-bottom: 1px solid #d9d9d9;
display: inline-block;
color: #999;
padding: 2px;">图. 在地图控件上显示实时位置</div>
</center></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../404/" title="8.3 身份认证" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                8.3 身份认证
              </span>
            </div>
          </a>
        
        
          <a href="../../404/" title="9.2 阿里云平台" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                9.2 阿里云平台
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/iot-book" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
    <script src="../../../assets/javascripts/application.6f02ae1b.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr../../../lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../../../../js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>